{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ device.device_type }} - {{ device.serial_number }}{% endblock %}

{% block content %}
<div class="container py-3">
  <!-- Header -->
  <h2 class="text-center fw-bold mb-3">
    <span class="d-inline-flex align-items-center px-4 py-2 rounded-pill shadow-sm bg-light border border-primary">
      <i class="bi bi-hdd me-2 text-primary fs-3"></i>
      <span class="text-gradient">{{ device.device_type }} - {{ device.serial_number }}</span>
    </span>
  </h2>

  <!-- Device Info -->
  <div class="card shadow-sm mb-4">
    <div class="card-header fw-bold">{% trans "Device Information" %}</div>
    <div class="card-body">
      <p><strong>{% trans "Type" %}:</strong> {{ device.device_type }}</p>
      <p><strong>{% trans "Serial Number" %}:</strong> {{ device.serial_number }}</p>
      <p><strong>{% trans "Status" %}:</strong>
        {% if device.status == "متاح" %}
          <span class="badge bg-success">{% trans "Available" %}</span>
        {% elif device.status == "مستخدم" %}
          <span class="badge bg-warning text-dark">{% trans "In Use" %}</span>
        {% elif device.status == "تحت الصيانة" %}
          <span class="badge bg-danger">{% trans "Under Maintenance" %}</span>
        {% endif %}
      </p>
      <p><strong>{% trans "Added At" %}:</strong> {{ device.added_at|date:"Y-m-d H:i" }}</p>
    </div>
  </div>

  <!-- Accessories -->
  <div class="card shadow-sm mb-4">
    <div class="card-header fw-bold">{% trans "Accessories" %}</div>
    <div class="card-body">
      {% if device.accessories.all %}
        {% for acc in device.accessories.all %}
          <div class="mb-2">
            <span class="badge bg-light text-dark border">{{ acc.name }}</span>
            <small class="text-muted">({{ acc.model|default:"-" }}, {{ acc.get_condition_display }}, {{ acc.quantity }})</small>
          </div>
        {% endfor %}
      {% else %}
        <span class="text-muted">{% trans "No accessories for this device." %}</span>
      {% endif %}
    </div>
  </div>

  <!-- Custodies -->
  <div class="card shadow-sm">
    <div class="card-header fw-bold">{% trans "Custody Records" %}</div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>{% trans "Employee" %}</th>
              <th>{% trans "Custody Date" %}</th>
              <th>{% trans "Return Date" %}</th>
              <th>{% trans "Accessories" %}</th>
            </tr>
          </thead>
          <tbody>
            {% with custodies=device.devicecustody_set.all %}
              {% if custodies %}
                {% for dc in custodies %}
                  <tr>
                    <td>{{ forloop.counter }}</td>
                    <td>{{ dc.custody.employee }}</td>
                    <td>{{ dc.custody_date|date:"Y-m-d" }}</td>
                    <td>
                      {% if dc.return_date %}
                        {{ dc.return_date|date:"Y-m-d" }}
                      {% else %}
                        <span class="badge bg-warning text-dark">{% trans "Not Returned" %}</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if dc.accessorycustody_set.all %}
                        {% for ac in dc.accessorycustody_set.all %}
                          <span class="badge bg-light text-dark border">{{ ac.accessory.name }} (x{{ ac.quantity }})</span>
                        {% empty %}
                          <span class="text-muted">{% trans "No accessories" %}</span>
                        {% endfor %}
                      {% else %}
                        <span class="text-muted">{% trans "No accessories" %}</span>
                      {% endif %}
                    </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="5" class="text-center text-muted py-4">
                    <i class="bi bi-info-circle"></i> {% trans "No custody records for this device." %}
                  </td>
                </tr>
              {% endif %}
            {% endwith %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Back button -->
  <div class="mt-3 text-center">
    <a href="{% url 'device_list' %}" class="btn btn-secondary">
      <i class="bi bi-arrow-left"></i> {% trans "Back to Devices" %}
    </a>
  </div>
</div>
{% endblock %}
