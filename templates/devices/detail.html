{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Device Details" %}{% endblock %}

{% block content %}
<div class="container my-3">
  <div class="card shadow">
    <!-- Header -->
    <div class="card-header d-flex justify-content-between align-items-center bg-primary text-white">
      <h4 class="mb-0">
        <i class="bi bi-laptop me-2"></i> {% trans "Device Details" %}
      </h4>
      <span class="badge bg-light text-dark px-3 py-2 fs-6">
        #{{ device.id }}
      </span>
    </div>

    <!-- Body -->
    <div class="card-body p-4">
      <div class="row g-4">
        
        <!-- Device Name -->
        <div class="col-md-6">
          <h6 class="text-secondary mb-1">
            <i class="bi bi-laptop-fill me-2"></i> {% trans "Device Name" %}
          </h6>
          <p class="mb-0 fw-semibold">
            {{ device.name_en }} / {{ device.name_ar }}
          </p>
        </div>

        <!-- Serial Number -->
        <div class="col-md-6">
          <h6 class="text-dark mb-1">
            <i class="bi bi-upc-scan me-2"></i> {% trans "Serial Number" %}
          </h6>
          <p class="mb-0 fw-semibold">{{ device.serial_number }}</p>
        </div>

        <!-- Brand -->
        <div class="col-md-6">
          <h6 class="text-dark mb-1">
            <i class="bi bi-cpu me-2"></i> {% trans "Brand" %}
          </h6>
          <p class="mb-0 fw-semibold">{{ device.brand }}</p>
        </div>

        <!-- Device Type -->
        <div class="col-md-6">
          <h6 class="text-dark mb-1">
            <i class="bi bi-hdd me-2"></i> {% trans "Device Type" %}
          </h6>
          <p class="mb-0 fw-semibold">
            {{ device.device_type.name_en }} / {{ device.device_type.name_ar }}
          </p>
        </div>

        <!-- Status -->
        <div class="col-md-6">
          <h6 class="text-dark mb-1">
            <i class="bi bi-flag me-2"></i> {% trans "Status" %}
          </h6>
          <p class="mb-0 fw-semibold">
            {% if device.status == "available" %}
              <span class="badge bg-success">{{ device.get_status_display }}</span>
            {% elif device.status == "in_use" %}
              <span class="badge bg-warning text-dark">{{ device.get_status_display }}</span>
            {% elif device.status == "maintenance" %}
              <span class="badge bg-info">{{ device.get_status_display }}</span>
            {% elif device.status == "lost" %}
              <span class="badge bg-danger">{{ device.get_status_display }}</span>
            {% endif %}
          </p>
        </div>

        <!-- Added At -->
        <div class="col-md-6">
          <h6 class="text-dark mb-1">
            <i class="bi bi-calendar-plus me-2"></i> {% trans "Added At" %}
          </h6>
          <p class="mb-0 fw-semibold">{{ device.added_at|date:"Y-m-d H:i" }}</p>
        </div>

        <!-- Notes -->
        <div class="col-12">
          <div class="p-3 rounded-3 border border-secondary bg-light">
            <h6 class="text-secondary mb-2">
              <i class="bi bi-card-text me-2"></i> {% trans "Notes" %}
            </h6>
            {% if device.notes %}
              <p class="mb-0">{{ device.notes|linebreaks }}</p>
            {% else %}
              <p class="text-muted fst-italic">{% trans "No notes provided." %}</p>
            {% endif %}
          </div>
        </div>

        <!-- Accessories -->
        <div class="col-12">
          <h5 class="mt-4">
            <i class="bi bi-plug me-2"></i> {% trans "Accessories" %}
            <span class="badge bg-secondary">{{ device.accessories.count }}</span>
          </h5>

          {% if device.accessories.all %}
            <ul class="list-group mt-2">
              {% for acc in device.accessories.all %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {{ acc.name_en }} / {{ acc.name_ar }}
                  <span class="badge bg-light text-dark">
                    {{ acc.get_status_display }} - {{ acc.get_condition_display }}
                  </span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted fst-italic mt-2">{% trans "No accessories registered for this device." %}</p>
          {% endif %}
        </div>

        <!-- Custody History -->
        <div class="col-12">
          <h5 class="mt-4">
            <i class="bi bi-clock-history me-2"></i> {% trans "Custody History" %}
          </h5>

          {% if device.custodies.all %}
            <div class="list-group mt-2">
              {% for dc in device.custodies.all %}
                <div class="list-group-item">
                  <p class="mb-1 fw-semibold">
                    <i class="bi bi-person me-2"></i> {{ dc.custody.employee.employee_profile.full_name }}
                  </p>
                  <small class="text-muted">
                    <i class="bi bi-calendar me-1"></i> {{ dc.custody.custody_date }}
                    â†’ 
                    {% if dc.custody.return_date %}
                      {{ dc.custody.return_date }}
                    {% else %}
                      {% trans "Not returned yet" %}
                    {% endif %}
                  </small>
                  {% if dc.notes %}
                    <p class="mt-2 text-muted"><i class="bi bi-sticky me-2"></i>{{ dc.notes }}</p>
                  {% endif %}
                </div>
              {% endfor %}
            </div>
          {% else %}
            <p class="text-muted fst-italic mt-2">{% trans "This device has never been assigned to custody." %}</p>
          {% endif %}
        </div>

      </div>
    </div>

    <!-- Footer -->
    <div class="card-footer d-flex justify-content-between">
      <a href="{% url 'device_list' %}" class="btn btn-secondary">
        <i class="bi bi-arrow-left-circle"></i> {% trans "Back" %}
      </a>
      <div>
        {% if perms.devices.change_device or user.is_superuser %}
          <a href="{% url 'device_edit' device.pk %}" class="btn btn-custom-warning">
            <i class="bi bi-pencil"></i> {% trans "Edit" %}
          </a>
        {% endif %}
        {% if perms.devices.delete_device or user.is_superuser %}
          <a href="{% url 'device_delete' device.pk %}" class="btn btn-danger mx-2">
            <i class="bi bi-trash"></i> {% trans "Delete" %}
          </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
